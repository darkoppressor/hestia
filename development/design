RTS with networked multiplayer

Client-server architecture
Lockstep network model
Simulation is thus deterministic
To that end, no floating point numbers in game code

World divided into chunks, those are grouped into regions of uneven sizes and shapes
Regions have a maximum possible size, determined using the range: [option_region_min, option_region_max]
Regions have a certain biome, which determines their ground type, for looks right now QQQ
Tiles exist in some places (whole world is not made of them)
The world is divided into an imaginary grid, with its squares being the size of the smallest tile type
Tiles must snap to this grid, and cannot be partially out of the world
Tiles are stored in a map, with their key being their tile coords (and thus unique)
Tiles cannot overlap
Tile types are wheat, tree, unfinished building, city building
Each tile type determines its size, and the buildings are bigger than wheat and trees
World is randomly generated in a very basic way for now QQQ
No tiles are placed in the center of any chunk, leaving it free for future cities
Leaders each have a unique color, randomly assigned for now QQQ
Each leader leads a civ
Each civ begins with one city, placed at the center of a random chunk in a random unique region
Cities belong to a civ
A city's region also belongs to the its civ
Cities exist in the world as a single city building tile, which belongs to the city
Building tiles, both unfinished and city, are always placed in the center of their chunk
Unfinished buildings have small civ-colored borders around them to indicate who the potential city belongs to
People belong to a city, and to its civ
No collision between people and tiles
No collision between people and other people

Maximum world size in pixels is 2^31 - 1 (max value of int32_t)

Civ has inventory, infinite
People have inventory, finite
A person accesses their civ inventory to deposit or withdraw items by going to their parent city
Building and repairing buildings is an exception to this, and people may access civ inventory in these cases
from anywhere

There is a global variable max population per city
Each city has a breeding cooldown
If a city has less than max population, its breeding cooldown ticks down
When the breeding cooldown reaches 0, it is set to breeding cooldown and a person is spawned for that city and civ

A person becomes hungry over time
When hungry past a threshold, person eats if possible
Starts by looking in inventory, then in small area around self for wheat tile, then in civ inventory

Chunks and regions persist through the whole game, and will be stored in vectors
Regions know their child chunks by index
Chunks know their parent region by index
Leaders and civs persist through the whole game, and will be stored in vectors
Leaders know their child civ by index
Civs know their parent leader by index
Civs know their child cities by index
Civs know their child regions by index
Cities know their parent civ by index
Cities are stored in a vector, and this vector can change throughout the game
Cities know their child city building tile by tile coords
Regions know their parent civ by index, if they have one
Regions with no parent are neutral territory

When a city building is killed, it needs to know what civ killed it
The parent city becomes property of the killing civ, the old and new civ are informed of this,
the city building is restored to some fraction of its max HP, and the city's people have their conquered cooldown started
When a person's conquered cooldown is in progress, AI other than basic survival (e.g., eating, fleeing) is disabled

Civs know their child unfinished building tiles by tile coords
When an unfinished building is killed, it should update its parent civ's knowledge of it
When an unfinished building is finished, it should update its parent civ's knowledge of it, then create a new city parent,
and inform the parent civ of this

People know their parent city by index
City building tiles know their parent city by index
Note that people and city building tiles' parent city index needs to be kept up to date when cities are constructed or abandoned
Unfinished buildings know their parent civ by index

People are stored in a vector, and this vector can change throughout the game
Cities know their child people by index (note that this list needs to be kept up to date when people spawn, change cities, or die)

People need to look at other people via a quadtree

All civs are hostile to each other for now QQQ

The Leader can order the creation of a new city by placing an unfinished building tile
Assuming the tile placement is acceptable, the new unfinished building tile is immediately spawned at the ordered location
When placing a new city, it cannot be within a region that is already occupied by another civ or that already contains an unfinished building

The Leader can order a repopulation for a city
If the city has less than its max population, people will be selected from other cities in the civ and changed to children of the city
There is a global minimum percentage of population that a city wants
People will only be sent from a city for repopulation purposes if their city has more than this minimum

The Leader can order a city to be abandoned, if there is more than one city in the Leader's civ
This causes the city's building to be removed, its people to be randomly evenly distributed among the civ's other cities,
the city to be removed, and the region that the city was in to become parentless

Biomes are:
FREEZING_GRASSLAND
TROPICAL_GRASSLAND
TEMPERATE_GRASSLAND
FREEZING_FOREST
TROPICAL_FOREST
TEMPERATE_FOREST
GLACIER
DESERT
ROCKY_WASTELAND

Time is measured in days, weeks, months, and years
Days pass every <constant number of seconds>
Weeks pass every 6 days
Months pass every 5 weeks
Years pass every 12 months

Every day, each region has a chance to generate a new wheat or tree tile
This chance is determined by the region's biome
The region's biome also determines the weighting towards wheat or tree

There are global constants for people's mass, max speed, and move force
People have velocity and acceleration
People have HP
People regen HP over time
People have a hunger level
When full, they are normal
When hungry, natural HP regen is stopped
When starving, they lose HP at the base regen rate
A person will only eat when they are hungry or worse

People have an attack range
People have Attack and Defense
Attacks always hit
An attack does attacker Attack - defender Defense damage to the defender's HP
Building tiles have HP and Defense
A person attacking a building works like a person attacking a person, except the building doesn't fight back
When a person arrives at their target person or building tile to attack, if the target is still there and valid, they begin an attack countdown
When the countdown ends, if the target is still there and valid, the attack occurs as outlined above
People cannot move during the attack COUNTDOWN
When a person kills another person, they get all of their inventory items, limited by what the killer can hold
Any items that the killer cannot hold are simply gone

People have AI

People have gathering AI
People can gather wheat and tree tiles
Gathering AI looks in chunks within some gathering range of parent city for wheat or tree tile
Should check chunks in random order each time, with the exception that it should start looking in the person's
current chunk if they are within the gather zone
Should check each chunk's tiles in random order each time
The person remembers the tile to gather based on its tile coords
When a person arrives at their target tile to gather, if the tile is still there and valid, they begin a gather countdown
When the countdown ends, if the tile is still there and valid, it is removed and wheat or wood is placed in the person's inv

People have empty inventory AI
A person can drop off items at civ inventory by going to its parent city
People try to carry a piece of wheat with them for eating purposes always

If a person becomes hungry, they are able to eat wheat from their inventory right then (if they have any)
If the person has no wheat in their inventory, they "forage" for wheat in an area around themself
If there is no nearby wheat, the person returns to their city and retrieves wheat from the civ inventory (if possible)

People have build new city AI
The person remembers the building tile to build based on its tile coords
When a person arrives at their target tile to build, if the tile is still there and valid, they begin a build countdown
When the countdown ends, if the tile is still there and valid, wood is removed from the person's inventory (if available,
the civ inventory if not, the order is abandoned if not available in either inventory) and the building is built
(if the order was not abandoned due to lack of resources)

People have repair parent city building tile AI
The person remembers the building tile to repair based on its tile coords
When a person arrives at their target tile to repair, if the tile is still there and valid, they begin a repair countdown
When the countdown ends, if the tile is still there and valid, wood is removed from the person's inventory (if available,
the civ inventory if not, the order is abandoned if not available in either inventory) and the HP of the building increases
(if the order was not abandoned due to lack of resources)

People have attack person melee AI and attack building melee AI, as described above

People have retreat AI
If the person's civ has multiple cities, they will retreat to a random city, more likely their home city
If the person's civ has only one city, they will retreat to it,
or to a random location in the world some distance away from their current location

Current person actions:
Gather wheat, gather tree, empty inventory, eat (from inventory), forage, eat at home, repair city building,
build unfinished building, retreat, attack enemy person with melee, attack enemy building with melee
When a person needs something to do, they compile a list of available orders
They sort this list in order of priority
They then select an order from the list randomly, weighted towards the top of the list
So the person picks an order, and now attempts to carry out that order
Some orders may become impossible (build building and it is killed); when this is determined they should be abandoned

All orders are attempted until they are completed, become impossible, or are interrupted
Interrupts can be:
Need to eat badly and no food in inv
HP low and need to retreat
Enemy person with strong strength difference nearby (or maybe compare relative nearby forces instead), and need to retreat
Enemy person nearby and want to attack it
Enemy building nearby and want to attack it
Parent city has just been conquered and thus the conquered cooldown is active

The civ item needs are determined thusly:
The civ looks at its population to determine how much food is needed (it should look to the future and shoot for a small surplus)
The civ looks at city repairs and new city builds to determine how much wood is needed (it shoots for a small surplus here too)

When a civ has no cities remaining, it is defeated
The leader is then unable to control anything in the game, but can still watch

The game has victory conditions (well, one for now)
If all VCs are off, the game has no end
Conquest victory condition: Be the only civilization left undefeated

QQQ Note: I believe this is where I left off back in school

Should it really be possible to abandon a city anytime?
What if players abandon cities just before they are conquered, preventing the attacker from gaining the city and its people?
Probably not allowing city abandoning when the city is under attack would work
How to determine if a city is under attack? Maybe just if hostile units are nearby?

Building maintenance
Buildings should not decay if they were recently damaged
Buildings should have a minimum decay threshold, below which their health will not drop due to decay

Building should add to the unfinished building's HP instead of insta finishing it
Multiple people could now build
Might not need flagging anymore
Could use flagging to affect build order priority
If a building is flagged, another person is less likely to work on it
This change would mean a need to change how tree need is calculated

Maybe production of new people should cost food from the civ inventory
Every constant amount of time, if food is available, consume one and tick towards new person birth
This would need to be factored into wheat need calculation

Farming
One piece of wheat could be used to plant a square of wheat tiles

Reconsider combat cooldown

Why do building and repairing buildings not require picking up materials from home city?
Currently people can acquire needed materials from the civ inventory wherever they are
Currently this is the one weird exception to this need

Need something to prevent city spam
Is there also a hard max?
Cost of building city could increase per city

QQQ Note: I need to deal with everything above here before moving on with design work

Campaigns with armies
Need to read my previous stuff on this
One thing I know is that armies should act a lot like a city,
in the sense that the people in the army get their civ inv food from the general instead of the city building tile,
the general is treated as their "home location", and their orders from AI levels higher than person come from the general, not their city or civ
Also, if a person in an army has its parent city change ownership, they are assigned a new parent city in their parent civ
When a civ is defeated, its armies should be given to ... someone

Have domination, and time VCs
Need a game option for ending year
Each leader needs a score

Per city order to stay near city?
This could also be a range setting per city, perhaps set by dragging some kind of rectangle
